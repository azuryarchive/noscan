// @ts-ignore
import fetch, { FormData } from 'node-fetch'
import type { ReadStream } from 'fs'
import type { malwareScanResult } from '../../../types'

/** **Detect Malware**
 * 
 * A function that determines whether a file is malware.
 */
export default async (stream: ReadStream) => {
  try {
    const form = new FormData()
    form.set('file', stream)

    const res = await fetch('https://api.unscan.co/malware', {
      method: 'POST',
      body: form
    })

    if (!res.ok) return null

    const json = await res.json() as malwareScanResult

    return json.infected
  } catch (err) {
    return null
  }
}